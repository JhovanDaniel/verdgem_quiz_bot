<div class="container-fluid px-4 py-5">
  <h1 class="display-4 fw-bold text-body-emphasis mb-3">
    Welcome back, <%= !current_user.nickname.blank? ? current_user.nickname : current_user.first_name %>! ðŸŽ“
  </h1> 
  
  <p class="lead text-muted mb-4">Choose your learning path and start mastering your CSEC subjects</p>
  
  <!-- Main Quiz Panels -->
  <div class="row g-4 mb-5">
    <!-- Adventure Mode Panel -->
    <div class="col-12 col-lg-6">
      <div class="card pt-5 border-0 text-center">
        <div class="panel-image">
          <%= image_tag "verdgem-quiz-hero.png", alt: "Adventure Mode", class: "img-fluid w-50 h-50 object-fit-cover" %>
        </div>
        <div class="card-body p-4">
          <h3 class="card-title display-5 fw-bold mb-3">Adventure Mode</h3>
          <p class="lead px-4">
            Embark on an exciting learning journey! Travel through the different subjects and topics in adventure mode!
          </p>
          <%= link_to "Start Adventure", '#', class:"btn btn-lg btn-primary" %>
        </div>
      </div>
    </div>
    
    <!-- Custom Quiz Panel -->
    <div class="col-12 col-lg-6">
      <div class="card pt-5 border-0 text-center bg-light rounded-4">
        <div class="panel-image">
          <%= image_tag "jade-expression-1.PNG", alt: "Custom Quiz", class: "img-fluid w-50 h-50 object-fit-cover" %>
        </div>
        <div class="card-body p-4">
          <h3 class="card-title display-5 fw-bold mb-3">Custom Quiz</h3>
          <p class="lead px-4">
            Intense and personalised quiz practice! Choose from different subjects, topics, and quiz types.
          </p>
          <%= link_to "Custom Quiz", quiz_select_path, class:"btn btn-lg btn-primary" %>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col mt-4">
    <h5 class="mb-0">
      <span class="text-primary"><%= current_user.monthly_quiz_attempts %></span> / 
      <span><%= current_user.max_quiz_attempts %></span>
    </h5>
    <p class="text-muted mb-0">Quiz attempts used this month</p>
  </div>
  <div class="col-auto">
    <div class="progress" style="width: 200px; height: 8px;">
      <% percentage = current_user.monthly_quiz_attempts.to_f / current_user.max_quiz_attempts * 100 %>
      <div class="progress-bar <%= percentage > 80 ? 'bg-danger' : 'bg-primary' %>" 
           role="progressbar" 
           style="width: <%= percentage %>%" 
           aria-valuenow="<%= percentage %>" 
           aria-valuemin="0" 
           aria-valuemax="100"></div>
    </div>
  </div>
  <h1 class="display-6 fw-bold text-body-emphasis lh-1 my-4">Your quiz history</h1>
  <% if @quiz_sessions.empty? %>
    <div class="alert alert-info">
      You haven't taken any quizzes yet. 
      <%= link_to "Start a quiz now", authenticated_root_path, class: "alert-link" %>.
    </div>
  <% else %>
    <div class="table-responsive">
      <table class="table table-borderless">
        <thead>
          <tr>
            <th>Date</th>
            <th>Subject</th>
            <th>Progress</th>
            <th>Score</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @quiz_sessions.each do |session| %>
            <tr>
              <td><%= format_date(session.created_at) %></td>
              <td><%= session.subject.name %></td>
              <td><%= session.completed_questions %> / <%= session.question_count %></td>
              <td>
                <% if session.completed? %>
                  <span class="badge <%= session.score_percentage >= 70 ? 'bg-primary' : 'bg-danger' %>">
                    <%= session.score_percentage %>%
                  </span>
                <% else %>
                  <span class="badge bg-white text-dark">In Progress</span>
                <% end %>
              </td>
              <td>
                <%= link_to "View", quiz_session_path(session), class: "btn btn-sm btn-outline-primary mx-1" %>
                <% if !session.completed? %>
                    <%= link_to "Resume Quiz", resume_quiz_path(session), class: "btn btn-sm btn-primary mx-1" %>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
      <%= link_to "See all quiz history", quiz_sessions_path, class: "btn btn-sm btn-dark mx-1" %>
    </div>
    <%= will_paginate @quiz_sessions, renderer: WillPaginate::Bootstrap5Renderer if defined?(WillPaginate) %>
  <% end %>
</div>